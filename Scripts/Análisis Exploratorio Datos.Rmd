---
title: "Análisis Exploratorio Datos"
output: html_document
---

# Análisis Exploratorio de los Datos

## Cargar librerías

```{r}
library(tidyverse)
```

## Leer datos

```{r}
data <- read.csv("/DatosJon/UPNA/3º Ciencia de Datos/S6/Analisis Multivariante y Visualizacion de Datos/Trabajo/Datos/Vehicle_Collisions.csv")
```

```{r}
data <- read.csv("C:/Users/ruben/OneDrive/Escritorio/UPNA/CIENCIA DE DATOS/6ºSemestre/AnalisisMultivarianteVisualizacionDatos/Trabajo Final/Motor_Vehicle_Collisions_-_Crashes.csv")
View(data)
```

## Contributing Factor Vehicle

```{r}
contr_v1 <- data |> 
  select(CONTRIBUTING.FACTOR.VEHICLE.1) |> 
  mutate(CONTR_V1 = CONTRIBUTING.FACTOR.VEHICLE.1) |> 
  filter(if_any(everything(), ~ . != "")) |> 
  count(CONTR_V1, name='FREQUENCY')

contr_v2 <- data |> 
  select(CONTRIBUTING.FACTOR.VEHICLE.2) |> 
  mutate(CONTR_V2 = CONTRIBUTING.FACTOR.VEHICLE.2) |> 
  filter(if_any(everything(), ~ . != "")) |> 
  count(CONTR_V2, name='FREQUENCY')

contr_v3 <- data |> 
  select(CONTRIBUTING.FACTOR.VEHICLE.3) |> 
  mutate(CONTR_V3 = CONTRIBUTING.FACTOR.VEHICLE.3) |> 
  filter(if_any(everything(), ~ . != "")) |> 
  count(CONTR_V3, name='FREQUENCY')

contr_v4 <- data |> 
  select(CONTRIBUTING.FACTOR.VEHICLE.4) |> 
  mutate(CONTR_V4 = CONTRIBUTING.FACTOR.VEHICLE.4) |> 
  filter(if_any(everything(), ~ . != "")) |> 
  count(CONTR_V4, name='FREQUENCY')

contr_v5 <- data |> 
  select(CONTRIBUTING.FACTOR.VEHICLE.5) |> 
  mutate(CONTR_V5 = CONTRIBUTING.FACTOR.VEHICLE.5) |> 
  filter(if_any(everything(), ~ . != "")) |> 
  count(CONTR_V5, name='FREQUENCY')

```

```{r}
# Normalizar los valores en CONTR_V1
contr_v1_cleaned <- contr_v1 |> 
  mutate(CONTR_V1 = recode(CONTR_V1,
    "Cell Phone (hand-Held)" = "Cell Phone (hand-held)",
    "Drugs (Illegal)" = "Drugs (illegal)",
    "Illnes" = "Illness",
    "Other Electronic Device" = "Other Devices",
    "Drugs (illegal)" = "Drugs (illegal)",
    "Unspecified" = "Unspecified",
    "Pedestrian/Bicyclist/Other Pedestrian Error/Confusion" = "Pedestrian Error/Confusion",
    "Aggressive Driving/Road Rage" = "Aggressive Driving"
  ))

contr_v1_cleaned |> 
  arrange(FREQUENCY)
```

```{r}
contr_v1 |> 
  ggplot(aes(x = reorder(CONTR_V1, FREQUENCY), y = FREQUENCY)) + 
  geom_bar(stat = "identity", fill = "steelblue") + 
  # coord_flip() +  # Rota el gráfico para mejor visualización
  labs(title = "Frecuencia de Factores Contribuyentes",
       x = "Factor Contribuyente",
       y = "Frecuencia") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle=45, hjust=1,size=6),
        axis.title = element_text(size=7),
        title = element_text(size=8),
        axis.title.x=element_blank(),
        legend.title = element_blank(),
        legend.position = c(0.8,0.9),
        legend.background = element_blank()
        )
```

## Vehicle Type Code:

```{r}
dataVT <- data |> 
  dplyr::select(VEHICLE.TYPE.CODE.1, VEHICLE.TYPE.CODE.2, VEHICLE.TYPE.CODE.3, VEHICLE.TYPE.CODE.4, VEHICLE.TYPE.CODE.5)

missing_data <- dataVT %>%
  summarise(across(everything(), ~ sum(is.na(.) | (is.numeric(.) & is.nan(.)) | .=="")))

missing_data_long <- missing_data %>%
  pivot_longer(everything(), names_to = "Variable", values_to = "Missing_Count")


# Crear el gráfico de barras
ggplot(missing_data_long, aes(x = Variable, y = Missing_Count, fill = Variable)) +
  geom_col() +  # Gráfico de barras
  labs(
    x = "Variable",  # Etiqueta del eje X
    y = "Número de valores problemáticos",  # Etiqueta del eje Y
    title = "Valores faltantes, no numéricos o cadenas vacías por variable"  # Título
  ) +
  theme_minimal() +  # Tema minimalista
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotar etiquetas del eje X
```
